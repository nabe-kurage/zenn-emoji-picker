# ğŸ”§ æŠ€è¡“ä»•æ§˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

Zenn Emoji Pickerã¯ã€Zennã®è¨˜äº‹ç·¨é›†ãƒšãƒ¼ã‚¸ã§AIã‚’æ´»ç”¨ã—ã¦æœ€é©ãªçµµæ–‡å­—ã‚’ææ¡ˆã™ã‚‹Chromeæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ
```
Chrome Extension (Manifest V3)
â”œâ”€â”€ Content Script      # Zennãƒšãƒ¼ã‚¸ã§ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
â”œâ”€â”€ Background Service  # APIå‘¼ã³å‡ºã—ãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”œâ”€â”€ Popup UI           # ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â””â”€â”€ Options Page       # è¨­å®šç”»é¢
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
Zennç·¨é›†ãƒšãƒ¼ã‚¸
    â†“ (ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º)
Content Script
    â†“ (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°)
Background Service
    â†“ (APIå‘¼ã³å‡ºã—)
AI Service (Gemini/Claude/OpenAI)
    â†“ (çµµæ–‡å­—ææ¡ˆ)
Popup UI
    â†“ (ã‚³ãƒ”ãƒ¼)
ãƒ¦ãƒ¼ã‚¶ãƒ¼
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Chrome Extension
- **Manifest**: Version 3
- **Service Worker**: Backgroundå‡¦ç†
- **Content Scripts**: DOMæ“ä½œãƒ»ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
- **Storage API**: è¨­å®šãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜

### AI APIçµ±åˆ
- **Gemini API**: Google Generative Language API
- **Claude API**: Anthropic Messages API
- **OpenAI API**: Chat Completions API

### é–‹ç™ºç’°å¢ƒ
- **è¨€èª**: JavaScript (ES2022)
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: ES Modules
- **API**: Chrome Extension APIs

## æ©Ÿèƒ½ä»•æ§˜

### 1. ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºæ©Ÿèƒ½

#### å¯¾è±¡ãƒšãƒ¼ã‚¸
- URL Pattern: `https://zenn.dev/*/articles/*/edit`
- ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼æ¤œå‡º: CodeMirror, textarea, contenteditable

#### ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†
```javascript
const MAX_LENGTH = 2000;
const START_LENGTH = 800;
const END_LENGTH = 400;

// é•·æ–‡ã®å ´åˆ: å‰åŠ800æ–‡å­— + å¾ŒåŠ400æ–‡å­—ã‚’æŠ½å‡º
if (text.length > MAX_LENGTH) {
  return `${text.substring(0, START_LENGTH)}\n\n[...ä¸­ç•¥...]\n\n${text.substring(text.length - END_LENGTH)}`;
}
```

### 2. AI APIçµ±åˆ

#### Gemini API
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent`
- **ãƒ¢ãƒ‡ãƒ«**: gemini-1.5-flash
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: 
  - temperature: 0.7
  - maxOutputTokens: 500
  - responseMimeType: 'application/json'

#### Claude API
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://api.anthropic.com/v1/messages`
- **ãƒ¢ãƒ‡ãƒ«**: claude-3-haiku-20240307
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - max_tokens: 500
  - anthropic-version: '2023-06-01'

#### OpenAI API
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://api.openai.com/v1/chat/completions`
- **ãƒ¢ãƒ‡ãƒ«**: gpt-3.5-turbo
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - max_tokens: 500
  - temperature: 0.7

### 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

#### æ¨™æº–JSONå½¢å¼
```json
{
  "main": {
    "emoji": "ğŸŒ¸",
    "reason": "è¨˜äº‹ã®ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒã‚’è¡¨ç¾"
  },
  "sub": [
    {
      "emoji": "ğŸ¦‹",
      "reason": "ã‚µãƒ–ææ¡ˆ1ã®ç†ç”±"
    },
    {
      "emoji": "âœ¨",
      "reason": "ã‚µãƒ–ææ¡ˆ2ã®ç†ç”±"
    }
  ]
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- JSONè§£æå¤±æ•—æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµµæ–‡å­—æä¾›
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹JSONæŠ½å‡º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### APIã‚­ãƒ¼ç®¡ç†
- **ä¿å­˜**: Chrome Storage API (local)
- **æš—å·åŒ–**: ãªã—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰
- **ã‚¹ã‚³ãƒ¼ãƒ—**: æ‹¡å¼µæ©Ÿèƒ½å†…ã®ã¿

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **CSP**: script-src 'self'; object-src 'self'
- **HTTPS**: ã™ã¹ã¦ã®APIé€šä¿¡ã§HTTPSå¼·åˆ¶
- **ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶é™**: manifest.jsonã§host_permissionsæŒ‡å®š

### æ¨©é™ç®¡ç†
```json
{
  "permissions": [
    "storage",      // è¨­å®šä¿å­˜
    "activeTab",    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã‚¢ã‚¯ã‚»ã‚¹
    "scripting"     // å‹•çš„ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥
  ],
  "host_permissions": [
    "https://zenn.dev/*",
    "https://api.anthropic.com/*",
    "https://api.openai.com/*",
    "https://generativelanguage.googleapis.com/*"
  ]
}
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
- **ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º**: < 100ms
- **APIå‘¼ã³å‡ºã—**: 2-10ç§’ï¼ˆAPIã«ã‚ˆã‚Šç•°ãªã‚‹ï¼‰
- **UIæ›´æ–°**: < 50ms

### ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡
- **ãƒ¡ãƒ¢ãƒª**: < 10MB
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: < 1MB
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿

### åˆ¶é™äº‹é …
- **æ–‡å­—æ•°åˆ¶é™**: 2000æ–‡å­—ï¼ˆãã‚Œä»¥ä¸Šã¯è‡ªå‹•è¦ç´„ï¼‰
- **åŒæ™‚æ¥ç¶š**: 1ã¤ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: APIæä¾›è€…ã®åˆ¶é™ã«æº–æ‹ 

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Content Scriptæ¥ç¶šã‚¨ãƒ©ãƒ¼
```javascript
// ping/pongã«ã‚ˆã‚‹æ¥ç¶šç¢ºèª
try {
  await chrome.tabs.sendMessage(tab.id, { action: 'ping' });
} catch (error) {
  // å‹•çš„ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥ã§å¾©æ—§
  await chrome.scripting.executeScript({
    target: { tabId: tab.id },
    files: ['content.js']
  });
}
```

### APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**: å†è©¦è¡Œãªã—ã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- **èªè¨¼ã‚¨ãƒ©ãƒ¼**: APIã‚­ãƒ¼ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- **JSONè§£æã‚¨ãƒ©ãƒ¼**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯çµµæ–‡å­—ã‚’æä¾›

### UI ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- **ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé ˜åŸŸ**: popup.htmlå†…ã®#errorã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ
- **ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—**: æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€API ã‚¨ãƒ©ãƒ¼ã€ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã‚¨ãƒ©ãƒ¼
- **å›å¾©æ–¹æ³•**: è¨­å®šç¢ºèªã€ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã€APIã‚­ãƒ¼å†è¨­å®š

## æ‹¡å¼µæ€§

### æ–°ã—ã„AI APIè¿½åŠ 
1. `background.js`ã«æ–°ã—ã„APIé–¢æ•°ã‚’è¿½åŠ 
2. `options.js`ã«è¨­å®šUIè¿½åŠ 
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 

### æ–°æ©Ÿèƒ½è¿½åŠ ãƒã‚¤ãƒ³ãƒˆ
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: åŒã˜ãƒ†ã‚­ã‚¹ãƒˆã®é‡è¤‡APIå‘¼ã³å‡ºã—é˜²æ­¢
- **å±¥æ­´æ©Ÿèƒ½**: éå»ã®ææ¡ˆã®ä¿å­˜ãƒ»è¡¨ç¤º
- **ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½**: ã‚ˆãä½¿ã†çµµæ–‡å­—ã®ä¿å­˜
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã§ã®çµµæ–‡å­—è¡¨ç¤º

## ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§

### å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶
- **Chrome**: 88+ (Manifest V3å¯¾å¿œ)
- **Edge**: 88+ (Chromiumãƒ™ãƒ¼ã‚¹)
- **ãã®ä»–**: Manifest V3å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶

### ä¾å­˜é–¢ä¿‚
- **Chrome Extension APIs**: chrome.storage, chrome.tabs, chrome.scripting
- **Web APIs**: fetch, JSON, console
- **DOM APIs**: querySelector, addEventListener

## ãƒ‡ãƒ—ãƒ­ã‚¤ä»•æ§˜

### é–‹ç™ºç’°å¢ƒ
```bash
# æ‹¡å¼µæ©Ÿèƒ½ã®èª­ã¿è¾¼ã¿
chrome://extensions/ â†’ ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰ â†’ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€
```

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ
- **Chrome Web Store**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¦æå‡º
- **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º**: crx ãƒ•ã‚¡ã‚¤ãƒ«é…å¸ƒ
- **é–‹ç™ºè€…å‘ã‘**: GitHub ãƒªãƒªãƒ¼ã‚¹

### å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
```
zenn-emoji-picker/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ background.js
â”œâ”€â”€ content.js
â”œâ”€â”€ popup.html
â”œâ”€â”€ popup.js
â”œâ”€â”€ options.html
â”œâ”€â”€ options.js
â””â”€â”€ icons/
    â”œâ”€â”€ icon16.png
    â”œâ”€â”€ icon32.png
    â”œâ”€â”€ icon48.png
    â””â”€â”€ icon128.png
```
// ========= pool.js =========

// æŠ€è¡“ç³»ãƒ»å‡¡åº¸ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆsubç”¨ï¼‰
export const BLACKLIST = new Set([
  "ğŸ’»",
  "ğŸ–¥ï¸",
  "ğŸ“±",
  "ğŸ“²",
  "ğŸ§ ",
  "ğŸ¤–",
  "âš™ï¸",
  "ğŸ”§",
  "ğŸ› ï¸",
  "ğŸ§©",
  "ğŸ–Šï¸",
  "ğŸ“",
  "ğŸ”",
  "ğŸ”",
  "ğŸ¨",
  "ğŸ’¡",
  "âœï¸",
  "ğŸ“š",
  "ğŸš€",
]);

// å›½æ——æ¤œå‡ºï¼ˆRegional Indicator 2æ–‡å­—ã®çµ„ã¿åˆã‚ã›ï¼‰
const isFlag = (s) => {
  if (!s) return false;
  const chars = Array.from(s);
  for (let i = 0; i < chars.length - 1; i++) {
    const cp1 = chars[i].codePointAt(0);
    const cp2 = chars[i + 1].codePointAt(0);
    const isRI1 = cp1 >= 0x1f1e6 && cp1 <= 0x1f1ff;
    const isRI2 = cp2 >= 0x1f1e6 && cp2 <= 0x1f1ff;
    if (isRI1 && isRI2) return true;
  }
  return false;
};

// ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¢—æ¸›OKï¼‰
export const CATEGORIES = {
  globe: ["ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸŒ"],
  mountain: ["ğŸ”ï¸", "â›°ï¸", "ğŸŒ‹", "ğŸ—»"],
  buildings: [
    "ğŸ•ï¸",
    "ğŸ–ï¸",
    "ğŸœï¸",
    "ğŸï¸",
    "ğŸï¸",
    "ğŸŸï¸",
    "ğŸ›ï¸",
    "ğŸ—ï¸",
    "ğŸ§±",
    "ğŸ˜ï¸",
    "ğŸ™ï¸",
    "ğŸšï¸",
    "ğŸ ",
    "ğŸ¡",
    "ğŸ¢",
    "ğŸ£",
    "ğŸ¤",
    "ğŸ¥",
    "ğŸ¦",
    "ğŸ¨",
    "ğŸ©",
    "ğŸª",
    "ğŸ«",
    "ğŸ¬",
    "ğŸ­",
    "ğŸ¯",
    "ğŸ°",
    "ğŸ’’",
    "ğŸ—¼",
    "ğŸ—½",
    "â›ª",
    "ğŸ•Œ",
    "ğŸ›•",
    "ğŸ•",
    "â›©ï¸",
    "ğŸ•‹",
  ],
  transport: [
    "ğŸš‚",
    "ğŸšƒ",
    "ğŸš„",
    "ğŸš…",
    "ğŸš†",
    "ğŸš‡",
    "ğŸšˆ",
    "ğŸš‰",
    "ğŸšŠ",
    "ğŸš",
    "ğŸš",
    "ğŸš‹",
    "ğŸšŒ",
    "ğŸš",
    "ğŸš",
    "ğŸš",
    "ğŸš‘",
    "ğŸš’",
    "ğŸš“",
    "ğŸš”",
    "ğŸš•",
    "ğŸš–",
    "ğŸš—",
    "ğŸš˜",
    "ğŸš™",
    "ğŸšš",
    "ğŸš›",
    "ğŸšœ",
    "ğŸï¸",
    "ğŸï¸",
    "ğŸ›µ",
    "ğŸ¦½",
    "ğŸ¦¼",
    "ğŸ›º",
    "ğŸš²",
    "ğŸ›´",
    "ğŸ›¹",
    "ğŸ›¼",
    "ğŸš",
    "ğŸ›£ï¸",
    "ğŸ›¤ï¸",
    "ğŸ›¢ï¸",
    "â›½",
    "ğŸš¨",
    "ğŸš¥",
    "ğŸš¦",
    "ğŸ›‘",
    "ğŸš§",
    "âš“",
    "â›µ",
    "ğŸ›¶",
    "ğŸš¤",
    "ğŸ›³ï¸",
    "â›´ï¸",
    "ğŸ›¥ï¸",
    "ğŸš¢",
    "âœˆï¸",
    "ğŸ›©ï¸",
    "ğŸ›«",
    "ğŸ›¬",
    "ğŸª‚",
    "ğŸ’º",
    "ğŸš",
    "ğŸšŸ",
    "ğŸš ",
    "ğŸš¡",
    "ğŸ›°ï¸",
    "ğŸ›¸",
  ],
  nature_plants: [
    "ğŸŒ±",
    "ğŸŒ²",
    "ğŸŒ³",
    "ğŸŒ´",
    "ğŸŒµ",
    "ğŸŒ¾",
    "ğŸŒ¿",
    "â˜˜ï¸",
    "ğŸ€",
    "ğŸ",
    "ğŸ‚",
    "ğŸƒ",
    "ğŸª´",
    "ğŸŒ·",
    "ğŸŒ¸",
    "ğŸŒ¹",
    "ğŸŒº",
    "ğŸŒ»",
    "ğŸŒ¼",
    "ğŸŒ",
    "ğŸŒ",
    "ğŸŒš",
    "ğŸŒ™",
    "â­",
    "ğŸŒŸ",
    "ğŸ’«",
    "âœ¨",
    "âš¡",
    "â˜€ï¸",
    "â›…",
    "ğŸŒ¤ï¸",
    "ğŸŒ¥ï¸",
    "â˜ï¸",
    "ğŸŒ¦ï¸",
    "ğŸŒ§ï¸",
    "â›ˆï¸",
    "ğŸŒ©ï¸",
    "ğŸŒ¨ï¸",
    "â„ï¸",
    "â˜ƒï¸",
    "â›„",
    "ğŸŒ¬ï¸",
    "ğŸ’¨",
    "ğŸŒªï¸",
    "ğŸŒ«ï¸",
    "ğŸŒŠ",
    "ğŸ’§",
    "ğŸ’¦",
    "â˜”",
    "ğŸŒˆ",
  ],
  animals: [
    "ğŸµ",
    "ğŸ’",
    "ğŸ¦",
    "ğŸ¦§",
    "ğŸ¶",
    "ğŸ•",
    "ğŸ¦®",
    "ğŸ•â€ğŸ¦º",
    "ğŸ©",
    "ğŸº",
    "ğŸ¦Š",
    "ğŸ¦",
    "ğŸ±",
    "ğŸˆ",
    "ğŸˆâ€â¬›",
    "ğŸ¦",
    "ğŸ¯",
    "ğŸ…",
    "ğŸ†",
    "ğŸ´",
    "ğŸ",
    "ğŸ¦„",
    "ğŸ¦“",
    "ğŸ¦Œ",
    "ğŸ¦¬",
    "ğŸ®",
    "ğŸ‚",
    "ğŸƒ",
    "ğŸ„",
    "ğŸ·",
    "ğŸ–",
    "ğŸ—",
    "ğŸ",
    "ğŸ‘",
    "ğŸ",
    "ğŸª",
    "ğŸ«",
    "ğŸ¦™",
    "ğŸ¦’",
    "ğŸ˜",
    "ğŸ¦£",
    "ğŸ¦",
    "ğŸ¦›",
    "ğŸ­",
    "ğŸ",
    "ğŸ€",
    "ğŸ¹",
    "ğŸ°",
    "ğŸ‡",
    "ğŸ¿ï¸",
    "ğŸ¦«",
    "ğŸ¦”",
    "ğŸ¦‡",
    "ğŸ»",
    "ğŸ»â€â„ï¸",
    "ğŸ¨",
    "ğŸ¼",
    "ğŸ¦¥",
    "ğŸ¦¦",
    "ğŸ¦¨",
    "ğŸ¦˜",
    "ğŸ¦¡",
    "ğŸ¾",
    "ğŸ¦ƒ",
    "ğŸ”",
    "ğŸ“",
    "ğŸ£",
    "ğŸ¤",
    "ğŸ¥",
    "ğŸ¦",
    "ğŸ§",
    "ğŸ•Šï¸",
    "ğŸ¦…",
    "ğŸ¦†",
    "ğŸ¦¢",
    "ğŸ¦‰",
    "ğŸ¦¤",
    "ğŸª¶",
    "ğŸ¦©",
    "ğŸ¦š",
    "ğŸ¦œ",
    "ğŸ¸",
    "ğŸŠ",
    "ğŸ¢",
    "ğŸ¦",
    "ğŸ",
    "ğŸ²",
    "ğŸ‰",
    "ğŸ¦•",
    "ğŸ¦–",
    "ğŸ³",
    "ğŸ‹",
    "ğŸ¬",
    "ğŸ¦­",
    "ğŸŸ",
    "ğŸ ",
    "ğŸ¡",
    "ğŸ¦ˆ",
    "ğŸ™",
    "ğŸš",
    "ğŸª¸",
    "ğŸª¼",
    "ğŸ¦€",
    "ğŸ¦",
    "ğŸ¦",
    "ğŸ¦‘",
    "ğŸª±",
    "ğŸŒ",
    "ğŸ¦‹",
    "ğŸ›",
    "ğŸœ",
    "ğŸ",
    "ğŸª²",
    "ğŸ",
    "ğŸª³",
    "ğŸª°",
  ],
  food_drink: [
    "ğŸ",
    "ğŸ",
    "ğŸ",
    "ğŸŠ",
    "ğŸ‹",
    "ğŸŒ",
    "ğŸ‰",
    "ğŸ‡",
    "ğŸ“",
    "ğŸ«",
    "ğŸˆ",
    "ğŸ’",
    "ğŸ‘",
    "ğŸ¥­",
    "ğŸ",
    "ğŸ¥¥",
    "ğŸ¥",
    "ğŸ…",
    "ğŸ†",
    "ğŸ¥‘",
    "ğŸ¥¦",
    "ğŸ¥¬",
    "ğŸ¥’",
    "ğŸŒ¶ï¸",
    "ğŸ«‘",
    "ğŸŒ½",
    "ğŸ¥•",
    "ğŸ«’",
    "ğŸ§„",
    "ğŸ§…",
    "ğŸ¥”",
    "ğŸ ",
    "ğŸ¥",
    "ğŸ¥¯",
    "ğŸ",
    "ğŸ¥–",
    "ğŸ¥¨",
    "ğŸ§€",
    "ğŸ¥š",
    "ğŸ³",
    "ğŸ§ˆ",
    "ğŸ¥",
    "ğŸ§‡",
    "ğŸ¥“",
    "ğŸ¥©",
    "ğŸ—",
    "ğŸ–",
    "ğŸŒ­",
    "ğŸ”",
    "ğŸŸ",
    "ğŸ•",
    "ğŸ«“",
    "ğŸ¥ª",
    "ğŸ¥™",
    "ğŸ§†",
    "ğŸŒ®",
    "ğŸŒ¯",
    "ğŸ«”",
    "ğŸ¥—",
    "ğŸ¥˜",
    "ğŸ«›",
    "ğŸ¥«",
    "ğŸ",
    "ğŸœ",
    "ğŸ²",
    "ğŸ›",
    "ğŸ£",
    "ğŸ±",
    "ğŸ¥Ÿ",
    "ğŸ¦ª",
    "ğŸ¤",
    "ğŸ™",
    "ğŸš",
    "ğŸ˜",
    "ğŸ¥",
    "ğŸ¥ ",
    "ğŸ¥®",
    "ğŸ¢",
    "ğŸ¡",
    "ğŸ§",
    "ğŸ¨",
    "ğŸ¦",
    "ğŸ¥§",
    "ğŸ°",
    "ğŸ‚",
    "ğŸ§",
    "ğŸ®",
    "ğŸ­",
    "ğŸ¬",
    "ğŸ«",
    "ğŸ¿",
    "ğŸ©",
    "ğŸª",
    "ğŸŒ°",
    "ğŸ¥œ",
    "ğŸ«˜",
    "ğŸ¯",
    "ğŸ¥›",
    "ğŸ¼",
    "â˜•",
    "ğŸµ",
    "ğŸ«–",
    "ğŸ¶",
    "ğŸº",
    "ğŸ»",
    "ğŸ¥‚",
    "ğŸ·",
    "ğŸ¥ƒ",
    "ğŸ¸",
    "ğŸ¹",
    "ğŸ§‰",
    "ğŸ¾",
  ],
  objects: [
    "âŒ›",
    "â³",
    "âŒš",
    "â°",
    "â±ï¸",
    "â²ï¸",
    "ğŸ•°ï¸",
    "ğŸ•›",
    "âš–ï¸",
    "ğŸª™",
    "ğŸ’°",
    "ğŸ’´",
    "ğŸ’µ",
    "ğŸ’¶",
    "ğŸ’·",
    "ğŸ’¸",
    "ğŸ’³",
    "ğŸ§¾",
    "ğŸ”¦",
    "ğŸ®",
    "ğŸª”",
    "â˜ï¸",
    "ğŸ“",
    "ğŸ“Ÿ",
    "ğŸ“ ",
    "ğŸ“º",
    "ğŸ“»",
    "ğŸ™ï¸",
    "ğŸšï¸",
    "ğŸ›ï¸",
    "ğŸ“¡",
    "ğŸ”‹",
    "ğŸ”Œ",
    "ğŸ–¨ï¸",
    "âŒ¨ï¸",
    "ğŸ–±ï¸",
    "ğŸ–²ï¸",
    "ğŸ’½",
    "ğŸ’¾",
    "ğŸ§®",
    "ğŸ¥",
    "ğŸï¸",
    "ğŸ“½ï¸",
    "ğŸ¬",
    "ğŸ“·",
    "ğŸ“¸",
    "ğŸ“¹",
    "ğŸ“¼",
    "ğŸ•¯ï¸",
    "ğŸ’„",
    "ğŸ’‹",
    "ğŸ‘“",
    "ğŸ•¶ï¸",
    "ğŸ¥½",
    "ğŸ¥¼",
    "ğŸ¦º",
    "ğŸ‘”",
    "ğŸ‘•",
    "ğŸ‘–",
    "ğŸ§£",
    "ğŸ§¤",
    "ğŸ§¥",
    "ğŸ§¦",
    "ğŸ‘—",
    "ğŸ‘˜",
    "ğŸ¥»",
    "ğŸ©±",
    "ğŸ©²",
    "ğŸ©³",
    "ğŸ‘™",
    "ğŸ‘š",
    "ğŸ‘›",
    "ğŸ‘œ",
    "ğŸ‘",
    "ğŸ›ï¸",
    "ğŸ’",
    "ğŸ©´",
    "ğŸ‘",
    "ğŸ‘Ÿ",
    "ğŸ¥¾",
    "ğŸ¥¿",
    "ğŸ‘ ",
    "ğŸ‘¡",
    "ğŸ©°",
    "ğŸ‘¢",
    "ğŸ‘‘",
    "ğŸ‘’",
    "ğŸ©",
    "ğŸ“",
    "ğŸ§¢",
    "ğŸª–",
    "â›‘ï¸",
    "ğŸ“¿",
    "ğŸ’",
    "ğŸ’",
  ],
  symbols: [
    "â¤ï¸",
    "ğŸ§¡",
    "ğŸ’›",
    "ğŸ’š",
    "ğŸ’™",
    "ğŸ’œ",
    "ğŸ–¤",
    "ğŸ¤",
    "ğŸ¤",
    "â¤ï¸â€ğŸ”¥",
    "â¤ï¸â€ğŸ©¹",
    "ğŸ’”",
    "â£ï¸",
    "ğŸ’•",
    "ğŸ’",
    "ğŸ’“",
    "ğŸ’—",
    "ğŸ’–",
    "ğŸ’˜",
    "ğŸ’",
    "ğŸ’Ÿ",
    "â˜®ï¸",
    "âœï¸",
    "â˜ªï¸",
    "ğŸ•‰ï¸",
    "â˜¸ï¸",
    "âœ¡ï¸",
    "ğŸ”¯",
    "ğŸª¯",
    "â˜¦ï¸",
    "ğŸ›",
    "â›",
    "â™ˆ",
    "â™‰",
    "â™Š",
    "â™‹",
    "â™Œ",
    "â™",
    "â™",
    "â™",
    "â™",
    "â™‘",
    "â™’",
    "â™“",
    "ğŸ†”",
    "âš›ï¸",
    "ğŸ‰‘",
    "â˜¢ï¸",
    "â˜£ï¸",
    "ğŸ“´",
    "ğŸ“³",
    "ğŸˆ¶",
    "ğŸˆš",
    "ğŸˆ¸",
    "ğŸˆº",
    "ğŸˆ·ï¸",
    "âœ´ï¸",
    "ğŸ†š",
    "ğŸ’ ",
    "â™»ï¸",
    "ğŸ”±",
    "ğŸ“›",
    "ğŸ”°",
    "â­•",
    "âŒ",
    "â",
    "â•",
    "â–",
    "â—",
    "â°",
    "â¿",
    "ã€½ï¸",
    "âœ³ï¸",
    "â‡ï¸",
    "Â©ï¸",
    "Â®ï¸",
    "â„¢ï¸",
  ],
};

// ã‚·ãƒ£ãƒƒãƒ•ãƒ«
const shuffle = (arr, rnd = Math.random) => {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(rnd() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};

/**
 * å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ã€Œ1/3ã ã‘ã€ï¼ˆç«¯æ•°åˆ‡ã‚Šä¸Šã’ã€æœ€ä½1ã¤ï¼‰å–ã‚Šå‡ºã—ã¦ WILDCARD_POOL ã‚’ä½œæˆ
 * - ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼å›½æ——ã‚’é™¤å¤–
 * - ã‚«ãƒ†ã‚´ãƒªå†…ã¯ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ä¸Šã‹ã‚‰é¸ã¶
 * - è¿”ã™é…åˆ—è‡ªä½“ã‚‚ã‚·ãƒ£ãƒƒãƒ•ãƒ«
 */
export function makeWildcardPoolOneThird({ rnd = Math.random } = {}) {
  const emoji2cat = {};
  Object.entries(CATEGORIES).forEach(([name, arr]) => {
    for (const e of arr) emoji2cat[e] = name;
  });

  const picksPerCategory = Object.entries(CATEGORIES).map(([name, arr]) => {
    const cleaned = arr.filter((e) => !BLACKLIST.has(e) && !isFlag(e));
    const take = Math.max(1, Math.ceil(cleaned.length / 3)); // 1/3ï¼ˆåˆ‡ã‚Šä¸Šã’ã€æœ€ä½1ï¼‰
    return shuffle(cleaned, rnd).slice(0, take);
  });

  const pool = shuffle(picksPerCategory.flat(), rnd);
  return { emojis: pool, emoji2cat, categories: CATEGORIES };
}

/**
 * sub ç”¨ã« 2 ã¤é¸ã¶ï¼ˆã‚«ãƒ†ã‚´ãƒªé‡è¤‡ãªã— & ãƒ—ãƒ¼ãƒ«å†…ï¼‰
 */
export function pickSubsFromPool(pool, rnd = Math.random) {
  const { emojis, emoji2cat } = pool;
  const shuffled = shuffle(emojis, rnd);
  let first = null,
    second = null;

  for (const e of shuffled) {
    if (!first) {
      first = e;
      continue;
    }
    if (emoji2cat[e] !== emoji2cat[first]) {
      second = e;
      break;
    }
  }
  if (!second) {
    for (const e of shuffled) {
      if (e !== first && emoji2cat[e] !== emoji2cat[first]) {
        second = e;
        break;
      }
    }
  }
  return [first, second].filter(Boolean);
}
